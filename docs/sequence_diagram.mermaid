sequenceDiagram
    participant Main
    participant ThreadPool
    participant Worker
    participant Server
    participant FileSystem

    Main->>Main: Load Excel data
    Main->>Main: Filter unprocessed rows
    Main->>Main: Extract URLs
    
    Main->>ThreadPool: Create workers (N threads)
    
    loop For each URL
        Main->>ThreadPool: Submit download task
    end
    
    par Concurrent Downloads
        ThreadPool->>Worker: Assign task
        Worker->>Server: GET request (primary URL)
        alt Primary URL Success (200)
            Server-->>Worker: PDF bytes
            Worker->>Worker: Verify PDF magic bytes
            Worker->>FileSystem: Write PDF file
            Worker-->>ThreadPool: Success, 200, URL
        else Primary URL Failed
            Server-->>Worker: Error (404/403/timeout)
            Worker->>Server: GET request (secondary URL)
            alt Secondary URL Success (200)
                Server-->>Worker: PDF bytes
                Worker->>Worker: Verify PDF magic bytes
                Worker->>FileSystem: Write PDF file
                Worker-->>ThreadPool: Success, 200, URL
            else Both URLs Failed
                Server-->>Worker: Error
                Worker-->>ThreadPool: Failure, error code, URL
            end
        end
    end
    
    ThreadPool-->>Main: All results
    Main->>FileSystem: Write log.json
    Main->>Main: Print completion time